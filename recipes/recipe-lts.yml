---
# yaml-language-server: $schema=https://schema.blue-build.org/recipe-v1.json
# image will be published to ghcr.io/<user>/<name>

name: nargothrond-lts
description: This is an experimental build with older NVIDIA drivers.

base-image: ghcr.io/ublue-os/silverblue-main
image-version: 42  # Or "latest"

modules:
  - type: dnf
    repos:
      cleanup: true
      copr:
        -  kwizart/kernel-longterm-6.6
    remove:
      packages:
        - kernel
        - kernel-core
        - kernel-modules
        - kernel-modules-core
        - kernel-modules-extra
    install:
      install-weak-deps: true
      packages:
        - kernel-longterm
        - kernel-longterm-core
        - kernel-longterm-modules
        - kernel-longterm-modules-extra
          
  - type: dnf
    install:
      packages:
        - https://developer.download.nvidia.com/compute/cuda/repos/fedora39/x86_64/nvidia-driver-560.35.05-1.fc39.x86_64.rpm
        - https://developer.download.nvidia.com/compute/cuda/repos/fedora39/x86_64/nvidia-modprobe-560.35.05-1.fc39.x86_64.rpm
        - https://developer.download.nvidia.com/compute/cuda/repos/fedora39/x86_64/nvidia-persistenced-560.35.05-1.fc39.x86_64.rpm
        - https://developer.download.nvidia.com/compute/cuda/repos/fedora39/x86_64/nvidia-settings-560.35.05-1.fc39.x86_64.rpm
        - https://developer.download.nvidia.com/compute/cuda/repos/fedora39/x86_64/nvidia-libXNVCtrl-560.35.05-1.fc39.x86_64.rpm
        - https://developer.download.nvidia.com/compute/cuda/repos/fedora39/x86_64/nvidia-xconfig-560.35.05-1.fc39.x86_64.rpm

  - type: initramfs

  - type: signing # Necessary for signing files
